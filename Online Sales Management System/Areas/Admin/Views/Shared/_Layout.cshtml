@using System.Security.Claims
@{
    var title = ViewData["Title"] as string ?? "Admin";
    var userName = User?.Identity?.IsAuthenticated == true
        ? (User.FindFirstValue(ClaimTypes.Email) ?? User.Identity?.Name ?? "Admin")
        : "Guest";

    var isAccessDenied = (Context.Request.Path.Value ?? "").Equals("/Admin/Auth/AccessDenied", StringComparison.OrdinalIgnoreCase);
}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@title - OSMS</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { background: #f6f7fb; }
        .admin-shell { min-height: 100vh; }
        .sidebar {
            width: 270px;
            background: #0b1220;
            color: rgba(255,255,255,.86);
        }
        .sidebar a { color: rgba(255,255,255,.86); text-decoration: none; }
        .sidebar .nav-link { border-radius: .65rem; }
        .sidebar .nav-link.active, .sidebar .nav-link:hover { background: rgba(255,255,255,.10); }
        .content-area { flex: 1; }
        .topbar { background: #fff; border-bottom: 1px solid rgba(0,0,0,.06); }
        .kpi-card { border-radius: 1rem; }
        .card { border-radius: 1rem; }
        .shadow-sm { box-shadow: 0 10px 25px rgba(0,0,0,.06) !important; }
    </style>

    @RenderSection("Head", required: false)
</head>
<body>
    <div class="admin-shell d-flex">
        <aside class="sidebar p-3 d-none d-lg-block">
            @await Html.PartialAsync("_Sidebar")
        </aside>

        <div class="content-area d-flex flex-column">
            <header class="topbar">
                @await Html.PartialAsync("_Topbar", userName)
            </header>

            <main class="flex-grow-1 p-3 p-lg-4">
                @RenderBody()
            </main>

            <footer class="py-3 text-center text-muted small">
                © @DateTime.Now.Year Online Sales Management System
            </footer>
        </div>
    </div>

    @await Html.PartialAsync("_Toasts")
    @await Html.PartialAsync("_PermissionDeniedModal")

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    @if (isAccessDenied)
    {
        <script>
            // If authorization blocks the request and redirects here, show the modal too.
            window.addEventListener('DOMContentLoaded', function () {
                if (window.OSMS && typeof window.OSMS.showPermissionDenied === 'function') {
                    window.OSMS.showPermissionDenied();
                }
            });
        </script>
    }

    @RenderSection("Scripts", required: false)
</body>
</html>
